
# 处理机调度

## 处理机调度的层次
在多道程序系统中，一个作业提交后必须经过处理机的调度才能获得处理机进行执行

处理机调度分为三个层次 : **高级调度**、**中级调度**、**初级调度**。

### 高级调度/长程调度/作业调度

* 功能: 对外存上处于后备队列中的作业进行调度
* 使用范围 : 多道批处理系统

### 低级调度/短程调度/进程调度

* 功能 : 决定就绪队列中的哪个进程应获得处理机并将处理机分配给进程

### 中级调度/中程调度/内存调度
* 功能 : 将暂时不能运行的进程调至外存进行等待

## 作业调度

### 作业、作业步、JCB的概念
`作业`是用户在一次解题或一个事务处理过程中要求计算机系统所做工作的集合。包括程序、数据、作业说明书

`作业步`是作业经过的每个相对独立又相互关联的顺序加工步骤

`JCB`是存放作业控制信息和管理信息的数据结构

### 作业调度的功能
* 记录进入系统的各作业情况
* 按一定策略，从后备作业队列中挑选若干作业投入运行
* 为选中的作业分配资源
* 作业运行结束后进行善后处理
* 创建进程

### 作业调度的任务
* 决定接纳多少作业
* 决定接纳哪些作业

### 作业调度的算法
* 先来先服务(FCFS)
* 短作业优先(SJF)
* 优先级调度算法(PSA)
* 高响应比优先(HRRN)

## 进程调度
### 进程调度的任务、机制和方式

任务
* 保存处理机现场信息
* 按照算法选取进程
* 将处理机分配给进程

机制
* 由排队器、分派器和上下文切换器组成

方式
* 非抢占式
* 抢占式

### 进程调度的算法

* 先来先服务
  * 按照服务到达时间进行服务
* 短作业(进程)优先调度
  * 从后备队列选取若干估计运行时间最短的作业(进程)调入内存运行
* 高优先权调度算法
  * 每个进程都有一个关联的优先级，具有最高优先级的进程会被分派到处理机资源
  * 分为非抢占式优先权调度、抢占式优先权调度、静态优先权调度、动态优先权调度
* 高相应比优先调度算法
  * 每调度一个作业时，计算后备作业队列中每个作业的响应比，然后挑选响应比最高的作业投入运行

基于时间片的轮转调度算法
* 时间片轮转法
* 多级反馈队列调度算法

# 死锁

## 死锁的定义
如果在一个进程集合中的每个进程都在等待只能由该集合的其他一个进程才能引发的事件，就称发生了死锁

## 死锁产生的原因和条件
原因
* 资源有限，竞争资源
* 并发进程的推进顺序不当

死锁产生的条件
* 互斥条件 : 涉及的资源是非共享的
* 不可剥夺条件 : 不能强行剥夺进程拥有的资源
* 请求和保持条件 : 进程在等待新资源时继续占有已分配的资源
* 环路条件 : 存在进程循环链，每一个进程所获得的资源被下一个进程所请求

前三个条件是死锁产生的必要条件

## 处理死锁的方法
* 预防死锁
* 避免死锁
* 检测死锁
* 解除死锁

## 预防死锁
* 互斥条件无法破坏
* 破坏请求和保持条件
  * 采用预先静态分配方法
  * 释放已用完的资源再申请新的资源
* 破坏不可剥夺条件
  * 使一个进程已获得的资源在运行过程中可被剥夺
* 破坏环路条件
  * 采用有序资源分配方法

## 避免死锁
进程每次进行资源申请时，若分配资源后可能进入死锁则不分配资源，否则分配资源

## 检测和解除死锁

### 检测
通过`资源分配图`描述死锁，通过**简化资源分配图**检测死锁

简化资源分配图的步骤是
* 寻找一个既不阻塞又不孤立的进程结点Pi
* 去除该结点的分配边和请求边，使该结点成为一个孤立结点
* 重复第一步

若在简化资源分配图后，所有的进程都是孤立的结点，则称该图是可完全简化的，否则称该图不是可完全简化的

资源分配图不是可完全简化是死锁的充分条件

###　解除
* 通过抢占资源实现恢复
* 通过杀掉进程实现恢复
