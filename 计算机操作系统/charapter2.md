
# 前趋图和程序执行

* 前趋图

`前趋图`是一个 **有向无循环图** ，用于描述进程之间执行的前后关系。

前趋图中的每个结点用于描述一个程序段或者进程、语句；结点间的有向边用于表示两个结点之间存在的偏序关系或前趋关系。

* 程序的顺序执行

单个程序必须按照严格的先后次序顺序执行，这种程序执行的方式叫做`程序的顺序执行`。

* 程序的并发执行

`程序并发执行`是指若干个程序段同时在系统中运行,目的是充分发挥硬件的并行性，消除处理器I/O设备的互等现象，提高系统效率。

# 进程的描述

## 定义
`进程`是**一个具有独立功能的程序关于某个数据集合的一次运行活动，是系统进行资源分配和调度的一个独立单位**。

## 特征
进程包含以下特征
* **动态性** : 进程的实质的程序的一次执行，动态产生动态消亡
* **并发性** : 进程可以和其他进程一起并发执行
* **独立性** : 进程是一个能够运行的独立单位，也是系统分配和调度资源的独立单位
* **异步性** : 进程按各自独立的、不可预知的速度向前推进
* **结构特征** : 进程由程序、数据和进程控制块三部分组成

## 进程与程序的区别和联系
* 进程是一个动态概念，程序是一个静态概念
* 进程是短暂的，具有生命周期，但程序是长久存在的
* 一个程序可能对应多个进程，但一个进程仅对应一个程序

## 状态
进程的基本状态及转换
* 运行态 : 指当前进程已分配到CPU，程序正在执行
* 就绪状态 : 当前进程获取到其他资源，但没有分配到CPU
* 阻塞状态 : 进程暂时不能运行，不仅缺少CPU资源也缺少其他资源

## 五态模型
![五态模型](http://7xshpr.com1.z0.glb.clouddn.com/OperatingSystem-2-1.jpg)

## 挂起操作和进程状态的转换
![挂起操作及进程状态的转换](http://7xshpr.com1.z0.glb.clouddn.com/OperatingSystem-2-2.jpg)

## 进程管理中的数据结构PCB
`PCB`是系统对进程进行控制和管理的依据，是进程存在的唯一标志(进程创建时创建一个PCB，进程终止后收回该PCB)

PCB可以按队列进行组织，也可以按表进行组织

# 进程控制
进程控制的主要任务是控制进程的生命周期。
`原语`是**由若干机器指令构成的完成某种特定功能的一段程序**。原语的执行必须是连续的，单机系统通过**屏蔽中断**来实现。原语的特点:**原子性**、**中断屏蔽性**。

|动作|原语|触发条件|步骤|
|--|--|------|----|
|进程创建|create()|用户登录;作业调度;提供服务;应用请求|申请空白PCB；为新进程分配资源；初始化PCB的内容；将新进程插入就绪队列|
|进程终止||进程完成了任务;进程在执行过程中发生了异常|从队列中根据进程号找到并撤销它;将进程拥有的资源归还;若该进程有子进程，先撤销所有子进程;回收PCB|
|进程阻塞|block()|请求系统服务；启动某种操作；新数据尚未到达；无新工作可工作|调用阻塞原语block()阻塞自己；停止进程的执行；修改PCB状态信息；将其插入到阻塞队列；将处理机分配给其他就绪进程|
|进程唤醒|wakeup()|其他进程唤醒阻塞进程|从等待队列移除进程；修改PCB状态信息；将进程移入就绪队列|
|进程挂起|suspend()|||
|进程激活|active()|||

# 进程同步
进程之间有两种关系：**竞争关系**和**协作关系**。**进程的互斥**是解决进程间竞争关系的手段；**进程的同步**是解决进程间协作关系的手段。

`临界资源`是**一次仅允许一个进程使用的资源**。

`临界区`是**最多只允许一个进程访问的程序段**。

临界区的调度原则 : 对进入临界区的进程需要**互斥**和**同步**。

为保证临界资源的正确使用，将临界区分为四个部分: **进入区**、**临界区**、**退出区**、**剩余区**。

## 信号量机制
信号量机制用来处理进程同步问题。下面是信号量的类别。

### 整型信号量
定义s为一个用于表示资源数目的整型量，除初始化外仅能通过wait(s)和signal(s)操作

下图是整形信号量的原语操作(又称P/V操作)
![整型信号量的原语操作](http://7xshpr.com1.z0.glb.clouddn.com/OperatingSystem-2-3.jpg)

### 记录型信号量
除了定义用于表示资源数目的整型量value,还需定义一个进程链表指针L，
用于链接所有等待进程

下图是记录型信号量的原语操作
![记录型信号量的原语操作](http://7xshpr.com1.z0.glb.clouddn.com/OperatingSystem-2-4.jpg)

### AND信号量
有时程序运行需要不同种的资源各1个，AND信号量的思想是将程序所需要的这些资源一次性全部分配给进程，待进程使用完后一起释放。

下面是AND信号量的原语操作
![AND信号量的Swait操作](http://7xshpr.com1.z0.glb.clouddn.com/OperatingSystem-2-5.jpg)
![AND信号量的SSignal操作](http://7xshpr.com1.z0.glb.clouddn.com/OperatingSystem-2-6.jpg)

### 信号量集
有时程序运行需要不同数量的不同种资源，AND信号量不能解决，因此采用信号量集，一次将需要的资源全部分配

下面是信号量集的原语操作
![信号量集的Swait操作](http://7xshpr.com1.z0.glb.clouddn.com/OperatingSystem-2-7.jpg)
![信号量集的Ssignal操作](http://7xshpr.com1.z0.glb.clouddn.com/OperatingSystem-2-8.jpg)

### 信号量机制的应用

* 利用信号量实现进程互斥
  * 找出临界资源，在临界区前后分别施以wait()和signal()操作
* 利用信号量实现前驱关系
  * 针对不同进程的前驱设置一个信号量，在进程开始时执行wait()操作
  * 针对不同进程的后继设置一个信号量，在进程完毕时执行signal()操作   

# 经典进程的同步问题

## 生产者-消费者模型

![生产者-消费者模型的记录型信号量解决方法](http://7xshpr.com1.z0.glb.clouddn.com/OperatingSystem-2-9.jpg)

## 管程--此部分待重新整理
一个管程定义了一个数据结构和能为并发进程所执行的一组操作，这组操作能同步进程和改变管程中的数据

管程的三个组成部分
* 局部于管程的若干公共变量说明
* 对该数据结构进行操作的一组过程
* 对局部于管程的数据设置初值的语句，此外，还必须给管程赋予一个名称

## 哲学家进餐问题

## 读者-写者问题

# 进程通信
并发进程之间的交互必须满足两个基本条件:**同步**和**通信**
进程之间互相交换信息的工作称为`进程通信IPC`

进程通信分为以下几种
* 低级通信 : 只适用于在进程间交换少量信息的通信方式，缺点是效率低，通信对用户不透明
* 高级通信 : 可以在进程间高效地传送大量数据的通信方式，优点是传输效率高，用户使用方便

进程通信的类型
* 信号通信机制
  * 信号通信机制是一种简的异步通信机制，当事件发生时，核心或进程会发送一个代表事件的整数给进程
* 管道通信机制  
  * 管道是连接一个读进程和一个写进程以实现它们之间通信的一个特殊共享文件，数据发送者和接收者在确定对方存在的情况下通过管道进行通信
* 共享内存通信机制
  * 在存储器中划出一块共享存储区，各进程通过对共享存储区中的数据的读写来实现通信
* 消息传递系统
  * 直接通信
    * send(P，消息) : 将一条消息发送给进程P
    * receive(Q,消息) : 从进程Q接收一条消息
    * 通过`消息缓冲队列通信机制`实现
  * 间接通信
    * send(A，信件) : 将一封信件(消息)传送到信箱A
    * receive(A，信件) : 从信箱A接收一封信件(信件)
* 客户机-服务器系统

# 线程的基本概念

* 引入线程的目的
  * 引入进程的目的是使多个程序并发执行，提高资源使用率和系统效率
  * 引入线程的目的是减少程序并发执行所付出的时空开销

线程的特点
* 是进程的一个实体，可作为系统独立调度和分配的独立单位
* 不拥有系统资源
* 一个进程中的多个线程可以并发执行
* 系统开销小、切换快

多线程的优点
* 响应程度高
* 资源共享
* 经济
* 多处理器体系结构的利用

进程与线程的比较
* 调度 : 在支持线程的操作系统中，进程是资源分配的独立单位，线程是处理机调度的基本单位
* 并发性 : 同一进程内的线程可以并发执行，不同进程之间的线程也可以并发执行
* 拥有资源 : 进程拥有系统资源，线程并不拥有资源
* 独立性 : 不同进程的地址空间不同，而同一进程内的线程共享同一地址
* 系统开销 : 线程的切换开销比进程小

# 线程的实现

* 多对一模型
* 一对一模型
* 多对多模型
